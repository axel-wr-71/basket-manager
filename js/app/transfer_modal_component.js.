// js/app/transfer_modal_component.js

const adminSettings = {
    transferTexts: {
        auctionOnlyTitle: "AKTYWNA LICYTACJA",
        auctionOnlyDesc: "Zawodnik pozostaje dostÄ™pny w rotacji meczowej. MoÅ¼e graÄ‡ do momentu zakoÅ„czenia aukcji.",
        buyNowTitle: "TRANSFER NATYCHMIASTOWY",
        buyNowDesc: "Uwaga! Ustawienie ceny 'Kup Teraz' blokuje zawodnika. Nie bÄ™dzie on mÃ³gÅ‚ wystÄ…piÄ‡ w nadchodzÄ…cych meczach."
    }
};

const toggleBodyScroll = (lock) => {
    document.body.style.overflow = lock ? 'hidden' : '';
};

export function openTransferModal(player) {
    toggleBodyScroll(true);
    const texts = adminSettings.transferTexts;

    const modalHtml = `
        <div id="sell-player-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(12px);">
            <div style="background: #ffffff; width: 750px; border-radius: 32px; overflow: hidden; box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5); animation: modalSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); display: flex; flex-direction: column; max-height: 90vh;">
                
                <div style="background: #1a237e; padding: 35px; color: white; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="margin: 0; font-size: 1.6em; font-weight: 900; letter-spacing: -0.5px;">LIST ON TRANSFER MARKET</h2>
                        <p style="margin: 4px 0 0 0; opacity: 0.6; font-size: 0.9em;">Player: ${player.first_name} ${player.last_name}</p>
                    </div>
                    <button id="close-modal-btn" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 45px; height: 45px; border-radius: 14px; cursor: pointer; font-size: 1.5em;">&times;</button>
                </div>

                <div style="display: grid; grid-template-columns: 260px 1fr; overflow-y: auto;">
                    <div style="background: #f8fafc; padding: 35px; border-right: 1px solid #e2e8f0; text-align: center;">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${player.last_name}" style="width: 120px; height: 120px; background: white; border-radius: 25px; border: 4px solid #1a237e; margin-bottom: 20px;">
                        <div style="font-weight: 900; font-size: 1.2em; color: #1e293b;">${player.last_name}</div>
                        <div style="color: #64748b; font-size: 0.85em; font-weight: 700; margin-top: 5px;">OVR ${player.overall_rating} | ${player.position}</div>
                        
                        <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 20px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.02);">
                            <div style="font-size: 0.7em; color: #94a3b8; font-weight: 800; text-transform: uppercase; margin-bottom: 5px;">Market Value</div>
                            <div style="font-size: 1.4em; font-weight: 900; color: #1a237e;">$${((player.overall_rating || 70) * 150000).toLocaleString()}</div>
                        </div>
                    </div>

                    <div style="padding: 35px;">
                        <div id="sale-warning-box" style="padding: 20px; border-radius: 18px; margin-bottom: 30px; border: 1px solid #bae6fd; background: #f0f9ff; transition: all 0.3s ease;">
                            <div style="color: #075985; font-weight: 800; font-size: 0.85em; text-transform: uppercase;">âš½ ${texts.auctionOnlyTitle}</div>
                            <p style="margin: 6px 0 0 0; font-size: 0.8em; color: #0c4a6e; line-height: 1.5;">${texts.auctionOnlyDesc}</p>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div>
                                <label style="display: block; font-size: 0.75em; font-weight: 800; color: #64748b; margin-bottom: 10px; text-transform: uppercase;">Starting Bid ($)</label>
                                <input type="number" id="start-price-input" placeholder="Min. 10,000" style="width: 100%; padding: 14px; border-radius: 14px; border: 2px solid #e2e8f0; font-family: 'JetBrains Mono'; font-weight: 700;">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.75em; font-weight: 800; color: #64748b; margin-bottom: 10px; text-transform: uppercase;">Reserve Price ($)</label>
                                <input type="number" id="reserve-price-input" placeholder="Optional" style="width: 100%; padding: 14px; border-radius: 14px; border: 2px solid #e2e8f0; font-family: 'JetBrains Mono'; font-weight: 700;">
                            </div>
                        </div>

                        <div style="margin-bottom: 30px;">
                            <label style="display: block; font-size: 0.75em; font-weight: 800; color: #64748b; margin-bottom: 10px; text-transform: uppercase;">Buy Now Price ($)</label>
                            <input type="number" id="bn-price-input" placeholder="Enter amount to lock player" style="width: 100%; padding: 14px; border-radius: 14px; border: 2px solid #e2e8f0; font-family: 'JetBrains Mono'; font-weight: 800; color: #be123c;">
                        </div>

                        <button id="submit-listing-btn" style="width: 100%; padding: 20px; border-radius: 18px; border: none; background: #1a237e; color: white; font-weight: 800; cursor: pointer; font-size: 1.1em; box-shadow: 0 15px 30px rgba(26,35,126,0.3);">
                            CONFIRM MARKET LISTING
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <style>
            @keyframes modalSlideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
            input:focus { border-color: #1a237e !important; background: #f8fafc; outline: none; }
        </style>
    `;

    document.body.insertAdjacentHTML('beforeend', modalHtml);

    // Event Listeners
    const bnInput = document.getElementById('bn-price-input');
    bnInput.addEventListener('input', () => updateWarningUI(bnInput.value, texts));

    document.getElementById('close-modal-btn').addEventListener('click', closeTransferModal);
    document.getElementById('submit-listing-btn').addEventListener('click', () => {
        // Tu wyÅ›lij dane do Supabase
        console.log("Listing confirmed for player:", player.id);
        closeTransferModal();
    });
}

function updateWarningUI(val, texts) {
    const box = document.getElementById('sale-warning-box');
    if (val && parseInt(val) > 0) {
        box.style.background = '#fff1f2';
        box.style.borderColor = '#fecaca';
        box.innerHTML = `
            <div style="color: #be123c; font-weight: 800; font-size: 0.85em; text-transform: uppercase;">ðŸš« ${texts.buyNowTitle}</div>
            <p style="margin: 6px 0 0 0; font-size: 0.8em; color: #9f1239; line-height: 1.5;">${texts.buyNowDesc}</p>
        `;
    } else {
        box.style.background = '#f0f9ff';
        box.style.borderColor = '#bae6fd';
        box.innerHTML = `
            <div style="color: #075985; font-weight: 800; font-size: 0.85em; text-transform: uppercase;">âš½ ${texts.auctionOnlyTitle}</div>
            <p style="margin: 6px 0 0 0; font-size: 0.8em; color: #0c4a6e; line-height: 1.5;">${texts.auctionOnlyDesc}</p>
        `;
    }
}

export function closeTransferModal() {
    const modal = document.getElementById('sell-player-modal');
    if (modal) modal.remove();
    toggleBodyScroll(false);
}
